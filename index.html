<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>üíå —Å–µ—Ä–¥—Ü–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–≥—Ä–µ–ª–∞ —Ç—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: radial-gradient(circle at 50% 50%, #fff5f8, #ffe5ec, #ffd9e2, #ffccd5);
            background-size: 400% 400%;
            animation: softGradient 20s ease infinite;
            font-family: 'Caveat', 'Georgia', -apple-system, BlinkMacSystemFont, sans-serif;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            overflow: hidden;
            color: #3a2a3a;
        }

        @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&display=swap');

        @keyframes softGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            background: rgba(255, 240, 245, 0.15);
            z-index: 1;
            pointer-events: none;
        }

        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .heart-float {
            position: absolute;
            font-size: 60px;
            opacity: 0.2;
            filter: blur(6px) drop-shadow(0 0 15px rgba(255, 120, 150, 0.3));
            animation: floatHeart linear infinite;
            color: #ff8da1;
            pointer-events: none;
        }

        @keyframes floatHeart {
            0% { transform: translateY(110vh) rotate(0deg) scale(0.9); opacity: 0.15; }
            50% { opacity: 0.25; }
            100% { transform: translateY(-20vh) rotate(360deg) scale(1.3); opacity: 0; }
        }

        .sakura-petals {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        .petal {
            position: absolute;
            font-size: 28px;
            opacity: 0.6;
            filter: blur(1.5px) drop-shadow(0 0 8px rgba(255, 140, 170, 0.5));
            animation: petalFloatToHeart linear infinite;
            color: #ffb7c5;
            pointer-events: none;
            z-index: 2;
        }

        @keyframes petalFloatToHeart {
            0% {
                transform: translate(120vw, -20vh) rotate(0deg) scale(0.7);
                opacity: 0.5;
            }
            70% {
                opacity: 0.7;
            }
            100% {
                transform: translate(40vw, 50vh) rotate(360deg) scale(1.2);
                opacity: 0;
            }
        }

        .achievement-container {
            position: fixed;
            top: 20px;
            left: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1000000;
            pointer-events: none;
        }

        .achievement {
            background: rgba(255, 240, 245, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 180, 190, 0.8);
            border-radius: 60px;
            padding: 16px 40px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 10px 40px rgba(255, 100, 130, 0.3), 0 0 0 2px white;
            transform: translateY(-150px);
            opacity: 0;
            transition: transform 0.7s cubic-bezier(0.34, 1.4, 0.64, 1), opacity 0.5s;
            max-width: 90%;
            margin-bottom: 15px;
        }

        .achievement.show {
            transform: translateY(0);
            opacity: 1;
        }

        .achievement.hide {
            transform: translateY(-150px);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.4s;
        }

        .achievement-icon {
            font-size: 2.5rem;
            animation: achievementPulse 2s infinite;
        }

        .achievement-text {
            display: flex;
            flex-direction: column;
        }

        .achievement-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #b84c5c;
            letter-spacing: 2px;
        }

        .achievement-desc {
            font-size: 0.9rem;
            color: #6a3a4a;
            font-weight: 500;
        }

        @keyframes achievementPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .prologue {
            position: fixed;
            z-index: 100000;
            color: #5a3a4a;
            font-size: 1.4rem;
            text-align: center;
            max-width: 80%;
            line-height: 2;
            letter-spacing: 4px;
            text-transform: uppercase;
            font-weight: 500;
            opacity: 1;
            transition: opacity 2s ease;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(255, 200, 210, 0.8);
            font-family: 'Caveat', cursive;
        }

        .prologue.fade-out {
            opacity: 0;
        }

        .heart-chamber {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 3s cubic-bezier(0.19, 1, 0.22, 1);
            pointer-events: none;
        }

        .heart-chamber.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .heart-chamber.fade-out {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }

        .heart-core {
            position: relative;
            width: 320px;
            height: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            filter: drop-shadow(0 0 60px rgba(255, 100, 130, 0.8));
            transition: filter 0.2s;
        }

        .heart-svg {
            width: 100%;
            height: 100%;
            position: relative;
            z-index: 2001;
            stroke: white;
            stroke-width: 1.5;
        }

        .warmth-meter {
            position: fixed;
            bottom: 70px;
            left: 20%;
            width: 60%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            z-index: 10000;
            backdrop-filter: blur(5px);
            overflow: hidden;
            opacity: 0;
            transition: opacity 1s;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .warmth-meter.visible {
            opacity: 1;
        }

        .warmth-meter.fade-out {
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .warmth-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ffb6c1, #ff9eb5, #ff85a5, #ff6b8b);
            border-radius: 10px;
            transition: width 0.2s ease;
            box-shadow: 0 0 30px #ff85a5;
        }

        .warmth-text {
            position: fixed;
            bottom: 35px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #4a2a3a;
            font-size: 0.9rem;
            letter-spacing: 6px;
            text-transform: uppercase;
            z-index: 10000;
            opacity: 0;
            transition: opacity 1s;
            font-weight: 600;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            font-family: 'Caveat', cursive;
        }

        .warmth-text.visible {
            opacity: 1;
        }

        .warmth-text.fade-out {
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .fire-particle {
            position: fixed;
            pointer-events: none;
            font-size: 26px;
            animation: fireFloat 1.4s ease-out forwards;
            opacity: 0.9;
            filter: drop-shadow(0 0 25px currentColor);
            z-index: 30000;
            color: #ff6b4a;
            text-shadow: 0 0 30px #ff4500;
        }

        @keyframes fireFloat {
            0% { transform: translate(0, 0) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(1.2); opacity: 0; }
        }

        .envelope-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 300px;
            height: 220px;
            z-index: 50000;
            opacity: 0;
            visibility: hidden;
            transition: transform 0.6s cubic-bezier(0.34, 1.3, 0.64, 1), opacity 0.4s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .envelope-container.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }

        .envelope-container.fade-out {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s;
        }

        .envelope {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #ffffff, #fff0f0);
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(255, 100, 130, 0.3), 0 0 0 3px rgba(255, 255, 255, 0.9), 0 0 0 5px rgba(255, 200, 210, 0.5);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background: linear-gradient(145deg, #fff5f0, #ffe5e5);
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            border-radius: 25px 25px 0 0;
            transform-origin: top;
            transition: transform 0.5s cubic-bezier(0.34, 1.4, 0.64, 1);
            z-index: 15;
            border-bottom: 2px solid rgba(255, 180, 190, 0.5);
        }

        .envelope.open .envelope-flap {
            transform: rotateX(180deg);
        }

        .envelope-heart {
            font-size: 3.8rem;
            color: #ff4d6d;
            filter: drop-shadow(0 0 30px rgba(255, 80, 120, 0.7));
            animation: heartPulse 1.6s infinite;
            z-index: 20;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .envelope-heart:hover {
            transform: scale(1.15);
            filter: drop-shadow(0 0 60px rgba(255, 80, 120, 0.9));
        }

        @keyframes heartPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.12); }
        }

        .paper-slide {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: min(520px, 82vw);
            height: min(420px, 72vh);
            background: #fffdfa;
            background-image: 
                radial-gradient(circle at 5% 8%, rgba(255,160,180,0.2) 2px, transparent 2px),
                radial-gradient(circle at 94% 92%, rgba(255,160,180,0.2) 2px, transparent 2px);
            border-radius: 32px;
            box-shadow: 0 30px 70px rgba(255, 100, 130, 0.25), 0 0 0 4px rgba(255, 255, 255, 0.9);
            padding: 35px 30px;
            z-index: 60000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, transform 0.6s cubic-bezier(0.34, 1.2, 0.64, 1);
            display: flex;
            flex-direction: column;
            font-family: 'Caveat', cursive;
        }

        .paper-slide.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .corner {
            position: absolute;
            width: 45px;
            height: 45px;
            border: 3px solid rgba(200, 120, 140, 0.3);
        }

        .corner-tl { top: 15px; left: 15px; border-right: none; border-bottom: none; border-radius: 20px 0 0 0; }
        .corner-tr { top: 15px; right: 15px; border-left: none; border-bottom: none; border-radius: 0 20px 0 0; }
        .corner-bl { bottom: 15px; left: 15px; border-right: none; border-top: none; border-radius: 0 0 0 20px; }
        .corner-br { bottom: 15px; right: 15px; border-left: none; border-top: none; border-radius: 0 0 20px 0; }

        .paper-title {
            font-size: 2.2rem;
            color: #b84c5c;
            text-align: center;
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: 2px;
            font-family: 'Caveat', cursive;
        }

        .paper-body {
            font-size: 1.4rem;
            line-height: 1.8;
            color: #4a2a3a;
            text-align: center;
            white-space: pre-line;
            font-family: 'Caveat', cursive;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .paper-signature {
            font-size: 1.5rem;
            color: #a05a6a;
            text-align: right;
            font-style: italic;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed rgba(180, 100, 120, 0.4);
            font-family: 'Caveat', cursive;
        }

        .close-paper {
            position: absolute;
            bottom: -25px;
            right: 20px;
            background: rgba(255, 240, 245, 0.8);
            backdrop-filter: blur(15px);
            border: 1.5px solid rgba(255, 140, 160, 0.6);
            border-radius: 40px;
            padding: 12px 35px;
            color: #4a2a3a;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            letter-spacing: 4px;
            font-weight: 600;
            font-family: 'Caveat', cursive;
        }

        .close-paper:hover {
            background: rgba(255, 220, 230, 0.9);
            transform: scale(1.05);
        }

        #screenshot-canvas {
            display: none;
        }

        @media (max-width: 600px) {
            .heart-float { font-size: 50px; }
            .petal { font-size: 24px; }
            .paper-slide {
                width: 85vw;
                height: 65vh;
                padding: 25px 20px;
            }
            .paper-title { font-size: 1.9rem; }
            .paper-body { font-size: 1.2rem; }
            .paper-signature { font-size: 1.3rem; }
        }
    </style>
</head>
<body>

    <div class="floating-hearts" id="floatingHearts"></div>
    <div class="sakura-petals" id="sakuraPetals"></div>
    <div class="blur-overlay"></div>
    <div class="achievement-container" id="achievementContainer"></div>

    <div class="prologue" id="prologue">
        ‚ùÑÔ∏è
        <div style="margin-top: 35px; font-size: 2rem; letter-spacing: 6px;">–µ–≥–æ —Å–µ—Ä–¥—Ü–µ –æ—Å—Ç—ã–ª–æ</div>
        <div style="margin-top: 25px; font-size: 1.3rem; opacity: 0.9;">–Ω–æ —Ç—ã –º–æ–∂–µ—à—å –µ–≥–æ —Å–æ–≥—Ä–µ—Ç—å</div>
        <div style="margin-top: 60px; font-size: 1rem; opacity: 0.7; letter-spacing: 10px;">–∫–æ—Å–Ω–∏—Å—å —Å–µ—Ä–¥—Ü–∞</div>
    </div>

    <div class="heart-chamber" id="heartChamber">
        <div class="heart-core" id="heartCore">
            <svg class="heart-svg" viewBox="0 0 100 100" width="320" height="320">
                <defs>
                    <linearGradient id="heartGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#3a5a7a" id="gradStart"/>
                        <stop offset="100%" stop-color="#1e2e3e" id="gradEnd"/>
                    </linearGradient>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <path d="M50,25 C20,0 0,30 0,45 C0,70 30,85 50,95 C70,85 100,70 100,45 C100,30 80,0 50,25 Z" 
                      fill="url(#heartGrad)" filter="url(#glow)" stroke="white" stroke-width="1.5"/>
            </svg>
        </div>
    </div>

    <div class="warmth-meter" id="warmthMeter">
        <div class="warmth-fill" id="warmthFill"></div>
    </div>
    <div class="warmth-text" id="warmthText">‚ù§Ô∏è‚Äçüî• —Å–æ–≥—Ä–µ–π –º–µ–Ω—è</div>

    <div id="fireContainer"></div>

    <div class="envelope-container" id="envelopeContainer">
        <div class="envelope" id="envelope">
            <div class="envelope-flap"></div>
            <div class="envelope-heart" id="envelopeHeart">üíå</div>
        </div>
    </div>

    <div class="paper-slide" id="paperSlide">
        <div class="corner corner-tl"></div>
        <div class="corner corner-tr"></div>
        <div class="corner corner-bl"></div>
        <div class="corner corner-br"></div>
        
        <div class="paper-title">üíó –º–æ–µ–π –¥—É—Ä–æ—á–∫–µ üíó</div>
        
        <div class="paper-body">
            —Ç—ã —Å–æ–≥—Ä–µ–ª–∞ –º–æ—ë —Å–µ—Ä–¥—Ü–µ.
            
            –æ–Ω–æ –∂–¥–∞–ª–æ —Ç–µ–±—è –≤—Å—é –∑–∏–º—É,
            –∞ —Ç—ã –ø—Ä–æ—Å—Ç–æ –∫–æ—Å–Ω—É–ª–∞—Å—å.
            
            —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å.
            
            —è —Ç–µ–±—è –ª—é–±–ª—é.
        </div>
        
        <div class="paper-signature">
            ‚ù§Ô∏è‚Äçüî• —Ç–≤–æ–π –Ω–∞–≤—Å–µ–≥–¥–∞
        </div>
        
        <div class="close-paper" id="closePaper">‚úß –∑–∞–∫—Ä—ã—Ç—å ‚úß</div>
    </div>

    <canvas id="screenshot-canvas"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        (function() {
            'use strict';

            for (let i = 0; i <= 9999; i++) clearInterval(i);
            document.querySelectorAll('.particle').forEach(p => p.remove());
            window.createParticles = () => {};

            const prologue = document.getElementById('prologue');
            const heartChamber = document.getElementById('heartChamber');
            const heartCore = document.getElementById('heartCore');
            const warmthMeter = document.getElementById('warmthMeter');
            const warmthFill = document.getElementById('warmthFill');
            const warmthText = document.getElementById('warmthText');
            const floatingHearts = document.getElementById('floatingHearts');
            const sakuraPetals = document.getElementById('sakuraPetals');
            const achievementContainer = document.getElementById('achievementContainer');
            
            const envelopeContainer = document.getElementById('envelopeContainer');
            const envelope = document.getElementById('envelope');
            const envelopeHeart = document.getElementById('envelopeHeart');
            const paperSlide = document.getElementById('paperSlide');
            const closePaper = document.getElementById('closePaper');
            const fireContainer = document.getElementById('fireContainer');
            
            let warmth = 0;
            let isPaperOut = false;
            let hundredAchievementShown = false;
            let screenshotTaken = false;

            async function autoTakeScreenshot() {
                if (screenshotTaken) return;
                
                try {
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    const canvas = await html2canvas(paperSlide, {
                        scale: 2.5,
                        backgroundColor: '#fffafc',
                        allowTaint: true,
                        useCORS: true,
                        logging: false
                    });
                    
                    const link = document.createElement('a');
                    link.download = `üíå-–ø–∏—Å—å–º–æ-–¥–ª—è-—Ç–µ–±—è-${new Date().getTime()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    screenshotTaken = true;
                } catch (e) {
                    console.error(e);
                }
            }

            function createFloatingHearts() {
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'heart-float';
                        heart.innerHTML = ['‚ù§Ô∏è', 'üíï', 'üíó', 'üíì', 'üíñ', 'üíò'][Math.floor(Math.random() * 6)];
                        heart.style.left = Math.random() * 100 + '%';
                        heart.style.animationDuration = (Math.random() * 18 + 18) + 's';
                        heart.style.fontSize = (Math.random() * 30 + 50) + 'px';
                        heart.style.animationDelay = (Math.random() * 10) + 's';
                        floatingHearts.appendChild(heart);
                    }, i * 150);
                }
                
                setInterval(() => {
                    if (document.visibilityState === 'visible' && floatingHearts.children.length < 25) {
                        const heart = document.createElement('div');
                        heart.className = 'heart-float';
                        heart.innerHTML = ['‚ù§Ô∏è', 'üíï', 'üíó', 'üíì', 'üíñ', 'üíò'][Math.floor(Math.random() * 6)];
                        heart.style.left = Math.random() * 100 + '%';
                        heart.style.animationDuration = (Math.random() * 18 + 18) + 's';
                        heart.style.fontSize = (Math.random() * 30 + 50) + 'px';
                        heart.style.filter = 'blur(7px)';
                        floatingHearts.appendChild(heart);
                        setTimeout(() => heart.remove(), 22000);
                    }
                }, 5000);
            }
            createFloatingHearts();

            function createSakuraPetals() {
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const petal = document.createElement('div');
                        petal.className = 'petal';
                        petal.innerHTML = ['üå∏', 'üå∏', 'üå∏', '‚ú®', 'üíÆ'][Math.floor(Math.random() * 5)];
                        petal.style.left = Math.random() * 100 + '%';
                        petal.style.animationDuration = (Math.random() * 12 + 12) + 's';
                        petal.style.fontSize = (Math.random() * 15 + 22) + 'px';
                        petal.style.animationDelay = (Math.random() * 8) + 's';
                        petal.style.opacity = 0.4 + Math.random() * 0.3;
                        sakuraPetals.appendChild(petal);
                    }, i * 200);
                }
                
                setInterval(() => {
                    if (document.visibilityState === 'visible') {
                        const petal = document.createElement('div');
                        petal.className = 'petal';
                        petal.innerHTML = ['üå∏', 'üå∏', 'üå∏', '‚ú®', 'üíÆ'][Math.floor(Math.random() * 5)];
                        petal.style.left = Math.random() * 100 + '%';
                        petal.style.animationDuration = (Math.random() * 12 + 12) + 's';
                        petal.style.fontSize = (Math.random() * 15 + 22) + 'px';
                        petal.style.opacity = 0.4 + Math.random() * 0.3;
                        sakuraPetals.appendChild(petal);
                        setTimeout(() => petal.remove(), 18000);
                    }
                }, 3000);
            }
            createSakuraPetals();

            function showHundredAchievement() {
                if (hundredAchievementShown) return;
                hundredAchievementShown = true;
                
                const achievement = document.createElement('div');
                achievement.className = 'achievement';
                
                achievement.innerHTML = `
                    <div class="achievement-icon">üíñ</div>
                    <div class="achievement-text">
                        <span class="achievement-title">üíØ —Å–µ—Ä–¥—Ü–µ —Å–æ–≥—Ä–µ—Ç–æ!</span>
                        <span class="achievement-desc">—Ç—ã —Ä–∞—Å—Ç–æ–ø–∏–ª–∞ –ª—ë–¥</span>
                    </div>
                `;
                
                achievementContainer.appendChild(achievement);
                
                setTimeout(() => {
                    achievement.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    achievement.classList.add('hide');
                    setTimeout(() => {
                        achievement.remove();
                    }, 600);
                }, 3500);
            }

            function updateHeartColor(warmthPercent) {
                const gradStart = document.getElementById('gradStart');
                const gradEnd = document.getElementById('gradEnd');
                
                let r, g, b;
                
                if (warmthPercent < 30) {
                    r = 70 + warmthPercent * 2;
                    g = 80 + warmthPercent * 1.5;
                    b = 120;
                } else if (warmthPercent < 60) {
                    r = 130 + (warmthPercent - 30) * 3;
                    g = 80 + (warmthPercent - 30) * 0.8;
                    b = 90 - (warmthPercent - 30) * 0.8;
                } else if (warmthPercent < 85) {
                    r = 220 + (warmthPercent - 60) * 1;
                    g = 70 + (warmthPercent - 60) * 2.5;
                    b = 50 + (warmthPercent - 60) * 0.8;
                } else {
                    r = 255;
                    g = 130 + (warmthPercent - 85) * 3;
                    b = 70 + (warmthPercent - 85) * 2;
                }
                
                r = Math.min(255, Math.max(0, Math.floor(r)));
                g = Math.min(220, Math.max(0, Math.floor(g)));
                b = Math.min(180, Math.max(0, Math.floor(b)));
                
                if (gradStart && gradEnd) {
                    gradStart.setAttribute('stop-color', `rgb(${r}, ${g}, ${b})`);
                    gradEnd.setAttribute('stop-color', `rgb(${r-40}, ${g-30}, ${b-20})`);
                }
                
                heartCore.style.filter = `drop-shadow(0 0 ${50 + warmthPercent * 1.5}px rgba(${r}, ${g}, ${b}, 0.7))`;
            }

            function createFireFromPoint(x, y) {
                const count = 6 + Math.floor(Math.random() * 6);
                for (let i = 0; i < count; i++) {
                    const p = document.createElement('div');
                    p.className = 'fire-particle';
                    p.innerHTML = ['üî•', 'üî•', '‚ú®', 'üî•'][Math.floor(Math.random() * 4)];
                    p.style.left = x + 'px';
                    p.style.top = y + 'px';
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 50 + Math.random() * 90;
                    p.style.setProperty('--dx', Math.cos(angle) * distance + 'px');
                    p.style.setProperty('--dy', Math.sin(angle) * distance - 50 + 'px');
                    p.style.fontSize = (Math.random() * 16 + 22) + 'px';
                    
                    fireContainer.appendChild(p);
                    setTimeout(() => p.remove(), 1400);
                }
            }

            setTimeout(() => {
                prologue.classList.add('fade-out');
                setTimeout(() => {
                    prologue.style.display = 'none';
                    heartChamber.classList.add('visible');
                    warmthMeter.classList.add('visible');
                    warmthText.classList.add('visible');
                    warmth = 0;
                    updateHeartColor(0);
                }, 2000);
            }, 3000);

            heartCore.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (window.navigator?.vibrate) window.navigator.vibrate(8);
                
                warmth = Math.min(warmth + 7, 100);
                warmthFill.style.width = warmth + '%';
                updateHeartColor(warmth);
                createFireFromPoint(e.clientX, e.clientY);
                
                if (warmth >= 100 && !window.heated) {
                    window.heated = true;
                    
                    for (let i = 0; i < 10; i++) {
                        setTimeout(() => createFireFromPoint(e.clientX, e.clientY), i * 40);
                    }
                    
                    showHundredAchievement();
                    
                    setTimeout(() => {
                        heartChamber.classList.add('fade-out');
                        warmthMeter.classList.add('fade-out');
                        warmthText.classList.add('fade-out');
                    }, 600);
                    
                    setTimeout(() => {
                        envelopeContainer.classList.add('show');
                    }, 1200);
                }
            });

            envelopeHeart.addEventListener('click', function(e) {
                e.stopPropagation();
                if (isPaperOut) return;
                
                envelope.classList.add('open');
                if (window.navigator?.vibrate) window.navigator.vibrate(20);
                
                for (let i = 0; i < 12; i++) {
                    setTimeout(() => createFireFromPoint(e.clientX, e.clientY), i * 20);
                }
                
                setTimeout(() => envelopeContainer.classList.add('fade-out'), 400);
                
                setTimeout(() => {
                    paperSlide.classList.add('show');
                    autoTakeScreenshot();
                }, 1500);
                
                isPaperOut = true;
            });

            closePaper.addEventListener('click', function(e) {
                e.stopPropagation();
                paperSlide.classList.remove('show');
                setTimeout(() => {
                    envelope.classList.remove('open');
                    envelopeContainer.classList.remove('fade-out');
                    envelopeContainer.classList.remove('show');
                }, 300);
                isPaperOut = false;
            });

            envelopeContainer.addEventListener('click', (e) => e.stopPropagation());
            envelopeHeart.addEventListener('click', (e) => e.stopPropagation());
            paperSlide.addEventListener('click', (e) => e.stopPropagation());
            closePaper.addEventListener('click', (e) => e.stopPropagation());
        })();
    </script>
</body>
</html>
